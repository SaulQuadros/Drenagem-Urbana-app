#!/usr/bin/env python
# coding: utf-8

# In[ ]:


import streamlit as st
from docx import Document
from docx.shared import Pt, Cm
from docx.enum.text import WD_PARAGRAPH_ALIGNMENT

# T√≠tulo do App
st.title('Calculadora de Par√¢metros de Bacia Hidrogr√°fica')

# Entrada dos dados da bacia hidrogr√°fica
st.sidebar.header('Insira os dados da bacia')

# Inputs com padroniza√ß√£o das unidades
area_km2 = st.sidebar.number_input('√Årea da Bacia (km¬≤)', min_value=10.0, format="%.2f")
perimetro_km = st.sidebar.number_input('Per√≠metro da Bacia (km)', min_value=20.0, format="%.2f")
comprimento_curso_principal_km = st.sidebar.number_input('Comprimento do Curso Principal (km)', min_value=2.0, format="%.2f")
comprimento_retalinea_km = st.sidebar.number_input('Comprimento em Linha Reta (km)', min_value=1.5, format="%.2f")
comprimento_total_cursos_agua_km = st.sidebar.number_input("Comprimento Total dos Cursos d'√Ågua (km)", min_value=4.0, format="%.2f")
desnivel_m = st.sidebar.number_input('Desn√≠vel da Bacia (m)', min_value=10.0, format="%.2f")

# C√°lculos dos par√¢metros
kf = area_km2 / (comprimento_curso_principal_km ** 2)
kc = 0.28 * perimetro_km / (area_km2 ** 0.5)
dd = comprimento_total_cursos_agua_km / area_km2
lm = area_km2 / (4 * comprimento_total_cursos_agua_km)
sc = comprimento_curso_principal_km / comprimento_retalinea_km
dc = (desnivel_m / (comprimento_curso_principal_km * 1000)) * 100

# Defini√ß√£o dos resultados para itera√ß√£o
resultados = [
    (
        "Coeficiente de Forma (Kf)",
        kf,
        "quanto mais pr√≥ximo de 1, mais arredondada √© a bacia, indicando picos de vaz√µes mais elevados e maior tend√™ncia para enchentes r√°pidas, sendo o oposto para valores que se aproximam de 0."
    ),
    (
        "Coeficiente de Compacidade (Kc)",
        kc,
        "quanto mais pr√≥ximo de 1, mais circular √© o formato da bacia e favorece o escoamento com altos picos de vaz√£o, sendo a bacia mais sujeita a inunda√ß√µes r√°pidas, sendo o oposto para valores que se afastam de 1."
    ),
    (
        "Densidade de Drenagem (Dd)",
        dd,
        "valores maiores que 1 indicam maior rapidez no escoamento superficial e menor infiltra√ß√£o, com maior risco de enchentes, e o inverso para valores menores que 1."
    ),
    (
        "Extens√£o M√©dia do Escoamento (lm)",
        lm,
        "valores entre 100m e 250m indicam uma bacia com drenagem moderada, com equil√≠brio entre infiltra√ß√£o e escoamento superficial, contudo, abaixo de 100 m, o escoamento superficial tende a ser r√°pido com pico de vaz√µes elevados, e acima de 250 m o inverso."
    ),
    (
        "√çndice de Sinuosidade (Sc)",
        sc,
        "valores pr√≥ximos de 1 indicam canais mais retos e maior efici√™ncia de drenagem, portanto, quanto maior o valor maior a sinuosidade e com isso, maior risco de enchentes."
    ),
    (
        "Declividade do Curso D'√°gua Principal (Dc)",
        dc,
        "valores abaixo de 1% indicam maior risco de enchentes, pois a drenagem √© demorada, sendo rios de plan√≠cies, e acima de 5% indicam rios com corredeiras e elevada velocidade de escoamento."
    )
]

# Exibi√ß√£o dos resultados
st.header('Resultados dos Par√¢metros da Bacia')
st.markdown(f'''
- **Coeficiente de Forma (Kf)**: {kf:.3f}  
  **Interpreta√ß√£o**: quanto mais pr√≥ximo de 1, mais arredondada √© a bacia, indicando picos de vaz√µes mais elevados e maior 
  tend√™ncia para enchentes r√°pidas, sendo o oposto para valores que se aproximam de 0.

- **Coeficiente de Compacidade (Kc)**: {kc:.3f}  
  **Interpreta√ß√£o**: quanto mais pr√≥ximo de 1, mais circular √© o formato da bacia e favorece o escoamento com altos picos de vaz√£o, 
  sendo a bacia mais sujeita a inunda√ß√µes r√°pidas, sendo o oposto para valores que se afastam de 1

- **Densidade de Drenagem (Dd)**: {dd:.3f} km/km¬≤  
  **Interpreta√ß√£o**: valores maiores que 1 indicam maior rapidez no escoamento superficial e menor infiltra√ß√£o, com maior risco de 
  enchentes, e o inverso para valores menores que 1.

- **Extens√£o M√©dia do Escoamento (lm)**: {lm:.3f} km
  **Interpreta√ß√£o**: valores entre 100m e 250m indicam uma bacia com drenagem moderada, com equil√≠brio entre infiltra√ß√£o e escoamento 
  superficial, contudo, abaixo de 100 m, o escoamento superficial tende a ser r√°pido com pico de vaz√µes elevados, e acima de 250 m 
  o inverso.

- **√çndice de Sinuosidade (Sc)**: {sc:.3f}  
  **Interpreta√ß√£o**: valores pr√≥ximos de 1 indicam canais mais retos e maior efici√™ncia de drenagem, portanto, quanto maior o valor 
  maior a sinuosidade e com isso, maior risco de enchentes.

- **Declividade do Curso D'√°gua Principal (Dc)**: {dc:.3f}%  
  **Interpreta√ß√£o**: valores abaixo de 1% indicam maior risco de enchentes, pois a drenagem √© demorada, sendo rios de plan√≠cies, 
  e acima de 5% indicam rios com corredeiras e elevada velocidade de escoamento. 
  .
''')

for nome, valor, interpretacao in resultados:
    st.markdown(f"- **{nome}**: {valor:.3f}  \n  **Interpreta√ß√£o**: {interpretacao}")

# Gerar documento Word formatado
if st.button('üìÑ Gerar Relat√≥rio em Word'):
    doc = Document()

    # Configura√ß√£o das margens
    sec = doc.sections[0]
    sec.top_margin = Cm(2.0)
    sec.bottom_margin = Cm(2.0)
    sec.left_margin = Cm(2.5)
    sec.right_margin = Cm(2.5)

    # T√≠tulo do relat√≥rio
    titulo = doc.add_heading('Relat√≥rio de Par√¢metros da Bacia Hidrogr√°fica', 0)
    titulo.alignment = WD_PARAGRAPH_ALIGNMENT.CENTER
    titulo.runs[0].font.size = Pt(16)
    titulo.runs[0].bold = True
    titulo.runs[0].font.name = 'Aptos'

    # Adicionando os resultados
    for nome, valor, interpretacao in resultados:
        p = doc.add_paragraph()
        run = p.add_run(f"{nome}: {valor:.3f}\nInterpreta√ß√£o: {interpretacao}")
        run.font.size = Pt(11)
        run.font.name = 'Aptos'
        p.alignment = WD_PARAGRAPH_ALIGNMENT.JUSTIFY
        p.paragraph_format.space_after = Pt(8)

    doc.save("relatorio_bacia.docx")

    with open("relatorio_bacia.docx", "rb") as f:
        st.download_button("‚¨áÔ∏è Baixar relat√≥rio", f, file_name="relatorio_bacia.docx")

